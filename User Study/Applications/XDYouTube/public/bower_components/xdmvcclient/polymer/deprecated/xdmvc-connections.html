<link rel="import" href="../../polymer/polymer.html">
<script src="../js/xdmvc.js"></script>
<polymer-element name="xdmvc-connections" attributes="roles">
	<template>
		<h2>Connected to</h2>
		<ul id='connections'>
			<template repeat="{{c in connections}}">
				<li>
                    <div>{{c.peer}} <button on-click="{{disconnectClicked}}">Disconnect</button> <button on-click="{{toggleDetails}}">></button>
                    </div>
                    <div class='details'>
                        <template repeat="{{r in roles}}">
                            <ul>
                                <label><input type="checkbox" checked="{{c.roles | contains(r)}}"/>{{r}}</label>
                            </ul>
                        </template>
                    </div>
                </li>
			</template>
		</ul>
	</template>
	<script>
		Polymer({
			created: function() {
				this.connections = XDmvc.connections;
			},
            
            disconnectClicked: function(event, detail, sender){
                XDmvc.disconnect(sender.parentNode.templateInstance.model.c.peer);
            },
			
            toggleDetails: function(event, detail, sender){
                var style = sender.parentNode.nextElementSibling.style.display;
                if (style !== "none") {
                    sender.parentNode.nextElementSibling.style.display = "none";
                } else {
                    sender.parentNode.nextElementSibling.style.display = "block";
                }
            },
            
           
            contains:  {
                toDOM: function(array, item) {
                     return array? array.indexOf(item) > -1 : false; 
                },
                toModel: function(checked, item) {
                    XDmvc.changeRoleForPeer(item, checked, this.c.peer);
                    return this.c.roles;

                }
            }
            
 		});
	</script>
</polymer-element>
