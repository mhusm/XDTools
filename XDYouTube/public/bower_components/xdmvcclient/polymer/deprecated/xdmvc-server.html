<link rel="import" href="../../polymer/polymer.html">
<script src="../../js/xdmvc.js"></script>
<polymer-element name="xdmvc-server" attributes="url reconnect port show">
	<template>
		<div id='userid'  contenteditable="true" on-blur="{{changeUserId}}" hidden?="{{!show}}">{{userId}}</div>
	</template>
	<script>
		Polymer({
			created: function() {
                this.url = document.location.hostname;
                this.port = "9000"
                this.reconnet = false;
                this.show = false;
				var id = localStorage.getItem("userId");
				this.deviceId = id? id:  "Id"+Date.now();
                localStorage.setItem("userId", this.deviceId);

			},
            
 			
			domReady: function(){
			// Automatically connect to the server
				var id = localStorage.getItem("userId");
                XDmvc.init(this.reconnect);
				if (this.deviceId != "Set Id") {
					XDmvc.connectToServer(this.deviceId, this.url, this.port);
				} 
			},
		  
			changeUserId: function(){
				var text = this.$.userid.textContent;
				if (text !== localStorage.getItem("userId")){
					localStorage.setItem("userId", text);
					this.deviceId = text;
					XDmvc.connectToServer(this.deviceId, this.url, this.port);
 
				}
			
			}
		});
	</script>
</polymer-element>
