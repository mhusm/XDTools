<link rel="import" href="../../polymer/polymer.html">
<link rel="import" href="xdmvc.html">

<script>
    Polymer({
        is: "xdmvc-synchronised",

        properties: {
            objects: {
                type: Object,
                value: false,
                notify: true
            },
            updateServer: {
                type: Boolean,
                value: false
            }
        },

        ready: function() {
            var sync = this.objects;
            var that = this;
            Object.keys(this.objects).forEach(function (key) {
                XDmvc.synchronize(
                        sync[key],
                        undefined,
                        key, that.updateServer,
                        function(id, key, value) {that.updateObject(id, key, value)},
                        function(id, splices) {that.updateArray(id, splices)}
                );
            });
        },

        updateObject: function(id, key, value){
            this.set(['objects', id, key], value);
        },

        updateArray: function(id, splices){
            var that = this;
            splices.forEach(function(spliceArgs){
                var args= ["objects."+id].concat(spliceArgs);
                that.splice.apply(that, args);
            });
        }

    });
</script>
